<!DOCTYPE html>
<html lang="ru">
<meta charset="utf-8">
<title>Подтверждение регистрации</title>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<style>
  body { font:16px/1.4 system-ui,sans-serif; max-width:420px; margin:4rem auto; text-align:center; }
  button { padding:12px 20px; border-radius:10px; border:1px solid #ccc; cursor:pointer; }
  #status { margin-top:20px; }
</style>

<body>
  <h1>Подтверждение регистрации</h1>
  <p>Нажмите кнопку ниже, чтобы завершить вход:</p>
  <button id="confirm">✅ Подтвердить регистрацию</button>
  <p id="status"></p>

<script>
const SUPABASE_URL = "https://gilbbgbmzzxsfnuguzci.supabase.co";
const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImdpbGJiZ2Jtenp4c2ZudWd1emNpIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTcxNzgyNTMsImV4cCI6MjA3Mjc1NDI1M30.ZlVU1kGvphzdEKAhVnMHnKQxcfhVcTpvYIFMhbrWURA";

const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

async function handleConfirmation() {
  const statusEl = document.getElementById("status");
  statusEl.textContent = "⏳ Проверяем токен...";

  const { data: { session }, error } = await supabase.auth.getSession();

  if (error || !session) {
    statusEl.textContent = "❌ Ошибка: " + (error?.message || "Сессия не найдена");
  } else {
    statusEl.textContent = "✅ Регистрация подтверждена!";
    // Очистка хэша и перенаправление на страницу входа
    history.replaceState(null, null, window.location.pathname);
    setTimeout(() => {
      window.location.href = '/index.html'; // Перенаправление на вторую страницу
    }, 1000);
  }
}

document.getElementById("confirm").onclick = handleConfirmation;
</script>
</body>
</html>
